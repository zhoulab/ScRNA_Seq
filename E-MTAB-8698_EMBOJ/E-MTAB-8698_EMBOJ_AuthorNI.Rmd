---
title: "E-MTAB-8698_EMBOJ_AuthorNI"
output: html_notebook
---
#refer to:
Cattenoz PB, Sakr R, Pavlidaki A, Delaporte C, Riba A, Molina N, Hariharan N, Mukherjee T, Giangrande A. Temporal specificity and heterogeneity of Drosophila immune cells. EMBO J. 2020 Jun 17;39(12):e104486. doi: 10.15252/embj.2020104486. Epub 2020 Mar 12. PMID: 32162708; PMCID: PMC7298292.

#Objectives:
## 1. explore in which hemocyte clusters are III markers expressed.
## 2. determine if III markers are differentially expressed in certain clusters than others
## 3. TBA

#Important files***:
## 1. E-MTAB-8698.sdrf.txt meta information for seurat object
## 2. filtered_feature_bc_matrix_NI_RRCZ22, unzipped folder that contains control (Non_Infected) group of hemocytes scRNAseq data
*** These files can be downloaded at https://www.ebi.ac.uk/biostudies/arrayexpress/studies/E%E2%80%90MTAB%E2%80%908698



set wk dir and library package
```{r}
setwd(getwd())

library(Seurat)
library(ggplot2)
library(cowplot)
library(Matrix)
library(dplyr)
library(ggsci)
library(data.table)
library(tidyverse)
library(patchwork)
library(clustree)
library(remotes)
```

#import seurat data and author's annotation
```{r}

Author_annotation <- data.table::fread(
  "./NI_cell_cluster_ID.txt"
  )

Author_annotation <- as.data.frame(Author_annotation)

NI <- Seurat::Read10X("./filtered_feature_bc_matrix/")

```

#create seurat OBJ
```{r}

NI <- CreateSeuratObject(counts = NI,
                           project = "Non_Infected_RRCZ22", 
                           min.cells = 0,  
                           min.features = 0)
```

#first check if author's annotation is the same as meta.data slot in SOBJ
```{r}
View(NI@meta.data)

#add "-1" rownames to change cell ID in Author_annotation to match meta.data slot
Author_annotation$Cell_ID <- paste0(Author_annotation$Cell_ID,"-1")

#check if author's annotation has the same number of cells as meta.data slot in SOBJ
nrow(NI@meta.data)
#7606
nrow(Author_annotation)
#7517

#they are not the same
```

#subset SOBJ to match author's annotation
```{r}
#first change cell ID in RNA slot to match meta.data slot
# 
# rownames(NI@assays[["RNA"]]@cells) <- rownames(NI@meta.data)
# rownames(NI@assays[["RNA"]]@cells)

table(rownames(NI@meta.data)%in%Author_annotation$Cell_ID)

NI2 <- NI[,rownames(NI@meta.data)%in%Author_annotation$Cell_ID]

# subset(NI,rownames(NI@meta.data)==Author_annotation$Cell_ID)


#check if NI2 has same cell number of Author_annotation
nrow(NI2@meta.data)
#7517
nrow(Author_annotation)
#7517
```

#merge author's annotation with NI2 meta.data slot
```{r}
View(NI2@meta.data)
table(rownames(NI2@meta.data)%in%Author_annotation$Cell_ID)
# TRUE 
# 7517 

NI2@meta.data$'annotation' <- Author_annotation$Cluster_ID
```


#change active idents into author's annotation
```{r}
Idents(NI2) <- NI2@meta.data$annotation
Idents(NI2)
```


```{r}

```

```{r}

```

```{r}

```

```{r}

```

